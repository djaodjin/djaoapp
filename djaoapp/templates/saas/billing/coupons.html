{% extends "saas/base_dashboard.html" %}

{% block saas_title %}{{organization.printable_name}} {% trans %}Coupons{% endtrans %}{% endblock %}

{% block saas_content %}
<div id="coupon-list-container">
<div data-trip data-trip-index="1" data-trip-content="<h2>{% trans %}Coupons{% endtrans %}</h2><p>{% trans %}Coupons are used to offer percentage discounts.<br />Create a coupon code with an associated discount percentage.<br />Distribute the coupon code to whoever is entitled<br />to a discount on their subscriptions. Users will be able to claim<br />the discount on the checkout page by entering the coupon code.{% endtrans %}</p><em>{% trans %}Use keyboard navigation or click 'Next' to move forward.{% endtrans %}</em>" data-trip-position="screen-center">
    <form class="form-inline mb-4" @submit.prevent="save">
        <div class="form-group my-3">
            <input type="text" class="form-control form-control-sm"
                   placeholder="{% trans %}Code{% endtrans %}"
                   v-model="newCoupon.code">
        </div>
        <div class="form-group my-3">
            <input type="text" class="form-control form-control-sm"
                  placeholder="{% trans %}Percent{% endtrans %}"
                  v-model="newCoupon.percent">
        </div>
        <button type="submit" class="btn btn-primary btn-sm"
                data-trip data-trip-index="2"
                data-trip-content="<p>{% trans %}Add a coupon by entering a code, percentage and click 'Create Coupon'.{% endtrans %}</p>"
                data-trip-position="s">{% trans %}Create Coupon{% endtrans %}</button>
    </form>
    <div class="btn-actions text-right">
        <a id="download" class="btn btn-secondary btn-sm" role="button"
           :href="'{{urls.provider.download_coupons}}' + getQueryString(['page'])"
           data-trip data-trip-index="7" data-trip-content="<p>{% trans %}Download the list of coupons if necessary.{% endtrans %}</p>" data-trip-position="s">
            <i class="fa fa-cloud-download"></i> {% trans %}CSV Download{% endtrans %}
        </a>
    </div>
    <hr />
    <div class="row my-3">
        {% include "saas/_filter.html" %}
    </div>
    <div class="text-center" v-show="!itemsLoaded">
        <h3 class="text-center"><i class="fa fa-refresh fa-spin fa-2x"></i></h3>
    </div>
    <div class="text-center" v-show="itemsLoaded && items.results.length === 0" v-cloak>
        <h4 class="text-center"><em>{% trans %}No Coupons{% endtrans %}<span v-show="params.q"> [[params.q]]</span></em></h4>
    </div>
    <div id="coupon-list" class="rtable rtable--6cols rtable--collapse rtable--stripe" v-show="itemsLoaded && items.results.length > 0" v-cloak>
        <div class="rtable-cell rtable-header">{% trans %}Code{% endtrans %}
            <a href="#" class="btn-sort"
              data-trip data-trip-index="5"
              data-trip-content="<p>{% trans %}Sort coupons by ascending and descending order.{% endtrans %}</p>"
              data-trip-position="s"
              @click.prevent="sortBy('code')">
              <i :class="sortIcon('code')"></i>
            </a>
        </div>
        <div class="rtable-cell" :class="{'is-striped': (index + 2) % 2 === 0}" :style="{order: index + 2}" v-for="(coupon, index) in items.results">
            <a :href="'{{urls.provider.metrics_coupons}}' + coupon.code + '/'">[[coupon.code]]</a>
        </div>
        <div class="rtable-cell" :style="{order: items.results.length + 2}" data-trip data-trip-index="8"
            data-trip-content="<p>{% trans %}Click on a coupon code to see who has redeem it.{% endtrans %}</p>" data-trip-position="s">
        </div>
        <div class="rtable-cell rtable-header">{% trans %}Percent{% endtrans %}
            <a href="#" class="btn-sort"
              @click.prevent="sortBy('percent')">
              <i :class="sortIcon('percent')"></i>
            </a>
        </div>
        <div class="rtable-cell" :class="{'is-striped': (index + 2) % 2 === 0}" :style="{order: index + 2}" v-for="(coupon, index) in items.results">
            [[coupon.percent]]
        </div>
        <div :style="{order: items.results.length + 2}"></div>
        <div class="rtable-cell rtable-header">{% trans %}Expires At{% endtrans %}
            <a href="#" class="btn-sort"
              @click.prevent="sortBy('ends_at')">
              <i :class="sortIcon('ends_at')"></i>
            </a>
        </div>
        <div class="rtable-cell" :class="{'is-striped': (index + 2) % 2 === 0}" :style="{order: index + 2}" v-for="(coupon, index) in items.results">
            <div style="display:inline-block">
                <uiv-dropdown class="form-group mb-0" append-to-body>
                  <btn class="dropdown-toggle btn-outline-secondary btn-sm"><i class="fa fa-calendar"></i></btn>
                  <template slot="dropdown">
                    <li>
                      <uiv-date-picker
                        v-model="coupon.ends_at"
                        @input="selected(index)"
                        icon-control-left="fa fa-caret-left"
                        icon-control-right="fa fa-caret-right" />
                    </li>
                  </template>
                </uiv-dropdown>
            </div>
            <span style="display: inline-block;" class="date">
                [[coupon.ends_at ? ($options.filters.formatDate(coupon.ends_at)) : "{% trans %}Never{% endtrans %}" ]]
            </span>
        </div>
        <div class="rtable-cell date" :style="{order: items.results.length + 2}" data-trip data-trip-index="3"
            data-trip-content="<p>{% trans %}Set the expiration date on a coupon.{% endtrans %}</p>" data-trip-position="s"></div>
        <div class="rtable-cell rtable-header">{% trans %}Description{% endtrans %}
            <a href="#" class="btn-sort"
              @click.prevent="sortBy('description')">
              <i :class="sortIcon('description')"></i>
            </a>
        </div>
        <div class="rtable-cell description" :class="{'is-striped': (index + 2) % 2 === 0}" :style="{order: index + 2}" v-for="(coupon, index) in items.results">
            <span @click="editDescription(index)"
              v-show="!edit_description[index]">[[coupon.description]] <i class="fa fa-pencil"></i></span>
            <input id="input_description" type="text" class="form-control"
              ref="edit_description_input"
              @keydown="saveDescription(coupon, index, $event)"
              @blur="saveDescription(coupon, index, $event)"
              v-model="coupon.description"
              v-show="edit_description[index]">
        </div>
        <div class="rtable-cell description" :style="{order: items.results.length + 2}" data-trip data-trip-index="4"
            data-trip-content="<p>{% trans %}Add a description for you to easily remember.{% endtrans %}</p>"
            data-trip-position="s">
        </div>
        <div class="rtable-cell rtable-header">{% trans %}Created At{% endtrans %}
            <a href="#" class="btn-sort"
              @click.prevent="sortBy('created_at')">
              <i :class="sortIcon('created_at')"></i>
            </a>
        </div>
        <div class="rtable-cell date" :class="{'is-striped': (index + 2) % 2 === 0}" :style="{order: index + 2}" v-for="(coupon, index) in items.results">
            [[coupon.created_at | formatDate]]
        </div>

        <div class="rtable-cell" :style="{order: items.results.length + 2}"></div>
        <div class="rtable-cell rtable-header"></div>
        <div class="rtable-cell" :class="{'is-striped': (index + 2) % 2 === 0}" :style="{order: index + 2}" v-for="(coupon, index) in items.results">
            <button class="btn btn-danger btn-sm" @click="remove(index)"><i class="fa fa-trash-o"></i>
            </button>
        </div>
        <div class="rtable-cell" :style="{order: items.results.length + 2}"></div>
    </div>
    <div class="text-center" v-show="itemsLoaded && totalItems > itemsPerPage">
        <b-pagination align="center" size="md" :total-rows="totalItems" v-model="params.page" :per-page="itemsPerPage" @input="get">
    </div>
</div>
</div>
{% endblock %}
