{% extends "saas/base_dashboard.html" %}

{% block saas_title %}<i class="fa fa-dollar"></i> {% trans %}Balances{% endtrans %}{% endblock %}

{% block saas_content %}
<balance-list inline-template id="balance-list-container">
<div>
  <div class="date-chooser pull-right">
      <a id="download" class="btn btn-secondary" role="button"
         :href="'{{urls.download_balances}}'+ getQueryString(['page'])"><i class="fa fa-cloud-download"></i> {% trans %}Download{% endtrans %}</a>
      <span>{% trans %}To{% endtrans %}</span>
      <div style="display:inline-block">
          <uiv-dropdown class="form-group" append-to-body>
              <btn class="dropdown-toggle"><i class="fa fa-calendar"></i></btn>
              <template slot="dropdown">
                  <li>
                      <uiv-date-picker
                        v-model="params.ends_at"
                        format="{{DATETIME_FORMAT}}"
                        @input="get"
                        icon-control-left="fa fa-caret-left"
                        icon-control-right="fa fa-caret-right" />
                  </li>
              </template>
          </uiv-dropdown>
      </div>
      <span class="date" style="display: inline-block;"
        data-trip data-trip-index="2"
        data-trip-content="<p>{% trans %}Look back through time.{% endtrans %}</p>"
        data-trip-position="s"
        >
          [[params.ends_at | formatDate ]]
      </span>
  </div>
  <table class="table table-condensed table-striped">
      <thead>
          <tr>
              <th>{% trans %}Rank{% endtrans %}</th>
              <th>{% trans %}Delete{% endtrans %}</th>
              <th>{% trans %}Title{% endtrans %}</th>
              <td style="text-align:right;"
                  v-for="col in values" v-cloak>
                  [[col[0] | monthHeading]]
              </td>
          </tr>
      </thead>
      <tbody v-show="!itemsLoaded">
          <tr>
              <td colspan="16">
                  <h3  class="text-center"><i class="fa fa-refresh fa-spin fa-2x"></i></h3>
              </td>
          </tr>
      </tbody>
      <tbody v-show="itemsLoaded && items.table.length == 0" v-cloak>
          <tr>
              <td colspan="16">
                  <h4 class="text-center"><em>{% trans %}No aggregated balances defined for this report. Add the first one with the form below.{% endtrans %}</em></h4>
              </td>
          </tr>
      </tbody>
      <tbody v-show="itemsLoaded && items.table.length > 0" v-cloak>
          <tr v-for="(row, index) in items.table">
              <td>
                  <div class="btn btn-secondary btn-sm">
                      <i class="fa fa-bars"></i></div>
              </td>
              <td>
                  <button class="btn btn-danger btn-sm"
                    @click="remove(row.key)">
                      <i class="fa fa-trash-o"></i></button>
              </td>
              <td>[[row.key]]</td>
              <td style="text-align:right;"
                  v-for="col in row.values">
                  <a target="_blank"
                     :href="'{{urls.broker_transactions}}' + row.selector + '/?start_at=' + startPeriod + '&ends_at=' + col[0] ">
                    [[humanizeCell(col[1])]]
                  </a>
              </td>
          </tr>
      </tbody>
  </table>
  <div class="row">
      <div class="col-sm-3">
          <input type="text" class="form-control form-control-sm"
            placeholder="{% trans %}Title{% endtrans %}"
            v-model="balanceLine.title">
      </div>
      <div class="col-sm-3">
          <input type="text" class="form-control form-control-sm"
            placeholder="{% trans %}Selector{% endtrans %}"
            v-model="balanceLine.selector">
      </div>
      <div class="col-sm-2">
          <button class="btn btn-primary btn-sm"
            @click="create"><i class="fa fa-plus"></i> {% trans %}Add Line{% endtrans %}</button>
      </div>
  </div>
</div>
</balance-list>
{% endblock %}
