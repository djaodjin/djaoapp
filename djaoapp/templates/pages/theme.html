{% extends "saas/base_dashboard-2col.html" %}

{% block saas_title %}Theme{% endblock %}

{% block saas_help %}
<p>
When you are modifying root templates (ex: <filename>base.html</filename>),
you may inadvertently break the dashboard and become unable to access this
page to upload a fix.
</p>
<p>
You can reset to the default theme, but you will need
<a href="{{urls.user.profile_redirect}}">an API key</a> to trigger
the <a href="https://djaodjin.com/docs/djaoapp-api/#themes_delete">API end point</a>
from the command line.
</p>
<pre class="code"><code>curl -i -u *api_key*: -X DELETE https://{{site_available_at_url}}/api/themes/</code></pre>
<p>
<a target="_blank" href="https://djaodjin.com/docs/themes/">Read more about theme customization ... &raquo;</a>
</p>
{% endblock %}

{% block saas_content %}
<div>
  <div class="mt-4">
    <div id="theme-upload" class="pages-upload"
         data-complete-url="{{urls.pages.api_themes}}"
         djupload-success >
      <div class="dropzone-previews previewsContainer">
        <span class="dz-default dz-message"><i class="fa fa-cloud"></i> Upload theme package (.zip)</span>
      </div>
    </div>
    <div class="text-center">
      <a id="download-theme" class="btn btn-secondary" href="{{urls.pages.theme_download}}" target="_blank"><i class="fa fa-cloud-download"></i> Download as .zip file</a>
      <button id="reset-theme" class="btn btn-danger">Reset to default</button>
    </div>
  </div>
</div>
<div>
  <div class="mt-4">
    <h4>Settings</h4>
    <form method="post">
        <input type="hidden" name="csrfmiddlewaretoken" value="{{csrf_token}}">
        <div class="form-group form-check">
          <input class="form-check-input" type="checkbox" name="show_edit_tools" id="show_edit_tools"{% if show_edit_tools %} checked{% endif %}>
          <label class="form-check-label" for="show_edit_tools">
            Show editor tools
          </label>
        </div>
        <button type="submit" class="btn btn-primary">Save</button>
    </form>
  </div>
</div>
{% endblock %}

{% block dashboard_bodyscripts %}
<script type="text/javascript">
jQuery(document).ready(function($) {
  $(".pages-upload").djupload({
      uploadUrl: "{{urls.pages.api_themes}}",
  });
  $("#reset-theme").click(function(event) {
     $.ajax({
         method: "DELETE",
         url: "{{urls.pages.api_themes}}",
         datatype: "json",
         contentType: "application/json; charset=utf-8",
         success: function(resp) {
           showMessages(["reset to default theme"], "success");
         },
         error: function(resp) {
           showErrorMessages(resp);
         }
     });
  });
});
</script>
{% endblock %}
